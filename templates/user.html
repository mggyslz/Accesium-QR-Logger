<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='/assets/favicon.ico') }}"/>
    {{ inject_csrf_meta_tag()|safe }}
    <title>User Dashboard</title>
    <link rel="stylesheet" href="/static/css/global.css" />
  </head>
  <body>
    <div class="dashboard-container">
      <aside class="sidebar" id="sidebar">
          <div class="sidebar-header" style="display: flex; align-items: center; gap: 10px;">
              <img src="{{ url_for('static', filename='assets/favicon.ico') }}"
                  alt="Logo"
                  style="width:32px; height:32px;">
              
              <div>
                  <h2 style="margin:0;">User Panel</h2>
                  <p style="margin:0;">Accesium</p>
              </div>
          </div>
          <nav class="sidebar-menu">
              <a href="#" class="menu-item active" onclick="showSection(event, 'dashboard')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="3" width="7" height="7"></rect>
                      <rect x="14" y="3" width="7" height="7"></rect>
                      <rect x="14" y="14" width="7" height="7"></rect>
                      <rect x="3" y="14" width="7" height="7"></rect>
                  </svg>
                  <span>Dashboard</span>
              </a>

              <a href="#" class="menu-item" onclick="showSection(event, 'qr')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <rect x="7" y="7" width="3" height="3"></rect>
                      <rect x="14" y="7" width="3" height="3"></rect>
                      <rect x="7" y="14" width="3" height="3"></rect>
                      <rect x="14" y="14" width="3" height="3"></rect>
                  </svg>
                  <span>My QR Code</span>
              </a>

              <a href="#" class="menu-item" onclick="showSection(event, 'attendance')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                      <line x1="16" y1="13" x2="8" y2="13"></line>
                      <line x1="16" y1="17" x2="8" y2="17"></line>
                      <polyline points="10 9 9 9 8 9"></polyline>
                  </svg>
                  <span>Attendance Records</span>
              </a>
              <div style="margin: 16px 20px 8px 20px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                  <span style="font-size: 10px; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Account</span>
              </div>
              <a href="#" class="menu-item" onclick="showSection(event, 'trusted-devices')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                      <line x1="12" y1="18" x2="12.01" y2="18"></line>
                  </svg>
                  <span>Trusted Devices</span>
              </a>
              <a href="#" class="menu-item" onclick="showSection(event, 'profile')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"></path>
                      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-1.42 3.42h-.11a1.65 1.65 0 0 0-1.57 1.09 2 2 0 0 1-3.8 0A1.65 1.65 0 0 0 11 21.3h-.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-3.42-1.42v-.11A1.65 1.65 0 0 0 4.21 18a2 2 0 0 1 0-3.8A1.65 1.65 0 0 0 3.12 13H3a2 2 0 0 1 0-4h.12A1.65 1.65 0 0 0 4.2 7a2 2 0 0 1 3.42-1.42l.06.06A1.65 1.65 0 0 0 9.2 5.12V5a2 2 0 0 1 4 0v.12A1.65 1.65 0 0 0 14.8 6.2a2 2 0 0 1 3.42 1.42v.11A1.65 1.65 0 0 0 19.79 11a2 2 0 0 1-.39 4z"></path>
                  </svg>
                  <span>Settings</span>
              </a>
          </nav>
          <div class="sidebar-footer">
              <form method="POST" action="{{ url_for('user.logout') }}" style="margin: 0">
                  {{ inject_csrf_input()|safe }}
                  <button type="submit" class="menu-item logout-btn" style="width: 100%; text-align: left; background: none; border: none; cursor: pointer; font: inherit; display: flex; align-items: center; gap: 12px;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                          <polyline points="16 17 21 12 16 7"></polyline>
                          <line x1="21" y1="12" x2="9" y2="12"></line>
                      </svg>
                      <span>Logout</span>
                  </button>
              </form>
          </div>
      </aside>
      <main class="main-content">
        <div class="topbar">
          <div class="topbar-left">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
            <div class="topbar-title">
              <h1 id="pageTitle">Dashboard</h1>
            </div>
          </div>
          <div class="topbar-right">
            <div class="user-info">
              <div class="user-info-top">
                <h3>{{ user[2] }}</h3>
                <p>@{{ user[1] }}</p>
              </div>
            </div>
          </div>
        </div>
        <div class="content-area">
          <div id="section-dashboard">
            <div class="welcome-section">
              <h2>Welcome back, {{ user[2].split()[0] }}!</h2>
              <p>Manage your QR code and view your attendance records.</p>
              <div class="activity-log">
                Last activity: <span id="lastActivityTime">Just now</span>
              </div>

              <div class="user-meta">
                <div class="user-meta-item">
                  <label>Status:</label>
                  <span>{{ user[6] }}</span>
                </div>
                <div class="user-meta-item">
                  <label>Role:</label>
                  <span>{{ user[3] }}</span>
                </div>
                <div class="user-meta-item">
                  <label>Total Records:</label>
                  <span id="totalRecords">0</span>
                </div>
              </div>
            </div>  

            <h3 style="margin: 24px 0 16px 0; font-size: 18px; font-weight: 600;">Today's Overview</h3>
            <div class="stats-grid">
                <div class="stat-card" id="statCardScans">
                    <div class="stat-card-header">
                        <div class="stat-card-icon icon-scans">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <path d="M21 15l-5-5L5 21"></path>
                            </svg>
                        </div>
                        <div class="stat-card-content">
                            <label>Today's Scans</label>
                        </div>
                    </div>
                    <div class="value" id="totalScansToday">0</div>
                </div>
                
                <div class="stat-card" id="statCardIn">
                    <div class="stat-card-header">
                        <div class="stat-card-icon icon-in">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <polyline points="19 12 12 19 5 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-card-content">
                            <label>Times In</label>
                        </div>
                    </div>
                    <div class="value" id="timesInToday">0</div>
                </div>
                
                <div class="stat-card" id="statCardOut">
                    <div class="stat-card-header">
                        <div class="stat-card-icon icon-out">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="12" y1="19" x2="12" y2="5"></line>
                                <polyline points="5 12 12 5 19 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-card-content">
                            <label>Times Out</label>
                        </div>
                    </div>
                    <div class="value" id="timesOutToday">0</div>
                </div>
                
                <div class="stat-card" id="statCardStatus">
                    <div class="stat-card-header">
                        <div class="stat-card-icon icon-status">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        <div class="stat-card-content">
                            <label>Current Status</label>
                        </div>
                    </div>
                    <div class="value" id="currentStatus">
                        <span class="status-badge">Loading...</span>
                    </div>
                </div>
            </div>

            <h3 style="margin: 24px 0 16px 0; font-size: 18px; font-weight: 600;">Recent Activity</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
              <!-- Left: Recent Location -->
            <div class="card" style="margin-bottom: 0;">
              <div class="card-header" style="margin-bottom: 12px; padding-bottom: 8px;">
                <h3 style="font-size: 14px; margin: 0;">Last Location</h3>
              </div>
              <div class="recent-location-content">
                <div class="location-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                </div>
                <div class="location-details">
                  <div class="location-name" id="recentLocation">Loading...</div>
                  <div class="location-time" id="recentLocationTime">--</div>
                </div>
              </div>
            </div>

              <!-- Right: Recent Activity Table -->
              <div class="card" style="margin-bottom: 0;">
                <div class="card-header" style="margin-bottom: 12px; padding-bottom: 8px;">
                  <h3 style="font-size: 14px; margin: 0;">Latest Scans</h3>
                </div>
                <div class="table-container" style="max-height: none; border: none;">
                  <table style="font-size: 13px;">
                    <thead>
                      <tr>
                        <th style="padding: 8px 12px; width: 80px;">Action</th>
                        <th style="padding: 8px 12px;">Last Scan</th>
                        <th style="padding: 8px 12px; width: 120px;">Location</th>
                      </tr>
                    </thead>
                    <tbody id="recentActivityTableBody">
                      <tr>
                        <td colspan="3" style="text-align: center; padding: 20px; color: var(--text-tertiary); font-size: 12px;">
                          Loading...
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <h3 style="margin: 24px 0 16px 0; font-size: 18px; font-weight: 600;">Activity</h3>
            <div class="card activity-heatmap-card">
              <div class="heatmap-container">
                <div class="heatmap-months" id="heatmapMonths"></div>
                <div class="heatmap-wrapper">
                  <div class="heatmap-columns" id="heatmapColumns">
                    <div style="text-align: center; padding: 40px; color: var(--text-tertiary); font-size: 13px;">
                      Loading activity data...
                    </div>
                  </div>
                </div>
                
                <div class="heatmap-legend">
                  <span class="legend-label">Less</span>
                  <div class="legend-square level-0"></div>
                  <div class="legend-square level-1"></div>
                  <div class="legend-square level-2"></div>
                  <div class="legend-square level-3"></div>
                  <div class="legend-square level-4"></div>
                  <span class="legend-label">More</span>
                </div>
              </div>
            </div>

            {% if session.get('force_password_change') or show_password_warning
            %}
            <div
              style="
                background: #fff3cd;
                border-left: 4px solid #ffc107;
                padding: 20px;
                margin-bottom: 30px;
                border-radius: 4px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
              "
            >
              <div style="display: flex; align-items: start; gap: 16px">
                <div style="font-size: 32px; color: #856404">⚠</div>
                <div style="flex: 1">
                  <h3
                    style="
                      margin: 0 0 8px 0;
                      color: #856404;
                      font-size: 18px;
                      font-weight: 600;
                    "
                  >
                    Password Change Required
                  </h3>
                  <p
                    style="
                      margin: 0 0 12px 0;
                      color: #856404;
                      font-size: 14px;
                      line-height: 1.6;
                    "
                  >
                    For security reasons, you must change your password before
                    continuing.
                  </p>
                  <a
                    href="#"
                    onclick="showSection(event, 'profile')"
                    style="
                      display: inline-block;
                      background: #856404;
                      color: white;
                      padding: 10px 20px;
                      text-decoration: none;
                      border-radius: 4px;
                      font-weight: 600;
                      font-size: 14px;
                      transition: background 0.3s;
                    "
                  >
                    Change Password Now →
                  </a>
                </div>
              </div>
            </div>
            {% endif %}
          </div>
          <div id="section-qr" class="section-hidden">
            <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Your QR Code</h3>
            <div class="card">
              <div class="card-actions">
                {% if user[4] %}
                <a
                  href="{{ url_for('static', filename='qrcodes/' ~ user[4]) }}"
                  download="{{ user[2]|replace(' ', '_') }}_QR.png"
                  class="btn btn-secondary"
                >
                  Download QR Code
                </a>
                {% endif %}
              </div>

              <div class="qr-display">
                <div class="qr-code-box">
                  {% if user[4] %}
                  <img
                    src="{{ url_for('static', filename='qrcodes/' ~ user[4]) }}"
                    alt="Your QR Code"
                  />
                  {% else %}
                  <img
                    src="{{ url_for('static', filename='img/no_qr.png') }}"
                    alt="No QR Code"
                  />
                  {% endif %}
                </div>

                <div class="qr-details">
                  <div class="qr-detail-item">
                    <label>Full Name</label>
                    <span>{{ user[2] }}</span>
                  </div>
                  <div class="qr-detail-item">
                    <label>Username</label>
                    <span>@{{ user[1] }}</span>
                  </div>
                  <div class="qr-detail-item">
                    <label>Role</label>
                    <span>{{ user[3] }}</span>
                  </div>
                  <div class="qr-detail-item">
                    <label>Status</label>
                    <span>{{ user[6] }}</span>
                  </div>
                </div>
                <div
                  style="
                    background: #fff3cd;
                    border-left: 4px solid #ffc107;
                    padding: 20px;
                    margin-top: 24px;
                    border-radius: 4px;
                  "
                >
                  <div
                    style="
                      font-weight: 600;
                      color: #856404;
                      margin-bottom: 8px;
                      font-size: 14px;
                    "
                  >
                    Your QR Scanner PIN
                  </div>
                  <div
                    style="
                      text-align: center;
                      font-size: 32px;
                      font-weight: bold;
                      letter-spacing: 8px;
                      font-family: 'Courier New', monospace;
                      color: #856404;
                      margin: 16px 0;
                    "
                  >
                    {{ user[7] if user|length > 7 else 'Contact Admin' }}
                  </div>
                  <div
                    style="font-size: 13px; color: #856404; text-align: center"
                  >
                    Use this 6-digit PIN when scanning your QR code at the gate
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="section-attendance" class="section-hidden">
            <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Attendance Records</h3>
            <div class="card">
              <div class="filters">
                <input
                  type="date"
                  id="filterDateFrom"
                  placeholder="From Date"
                />
                <input type="date" id="filterDateTo" placeholder="To Date" />
                <select id="filterAction">
                  <option value="">All Actions</option>
                  <option value="IN">IN Only</option>
                  <option value="OUT">OUT Only</option>
                </select>
              </div>

              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Action</th>
                      <th>Date</th>
                      <th>Time</th>
                      <th>Location</th>
                    </tr>
                  </thead>
                  <tbody id="attendanceBody">
                    <tr>
                      <td colspan="4" class="empty-state">
                        Loading attendance records...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="pagination">
                <button id="prevBtn" onclick="loadAttendance(currentPage - 1)">
                  Previous
                </button>
                <span class="page-info" id="pageInfo">Page 1</span>
                <button id="nextBtn" onclick="loadAttendance(currentPage + 1)">
                  Next
                </button>
              </div>
            </div>
          </div>
          <div id="section-trusted-devices" class="section-hidden">
            <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Trusted Devices</h3>
            <div class="card">
              <p style="color: #666; font-size: 14px; margin: 0 0 16px 0">
                Manage devices that can skip two-factor authentication
              </p>

              {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %} {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
              {% endfor %} {% endif %} {% endwith %}

              <div class="info-box">
                <p>
                  <strong>About Trusted Devices:</strong><br />
                  Devices marked as trusted will skip 2FA for 30 days. Only
                  trust personal devices. You can remove any device at any time
                  to require 2FA again.
                </p>
              </div>

              {% if devices %} {% for device in devices %}
              <div class="device-card">
                <div class="device-info">
                  <div class="device-name">{{ device[1] }}</div>
                  <div class="device-details">
                    <div><strong>IP Address:</strong> {{ device[2] }}</div>
                    <div><strong>Added:</strong> {{ device[3] }}</div>
                    <div><strong>Last Used:</strong> {{ device[4] }}</div>
                    <div><strong>Expires:</strong> {{ device[5] }}</div>
                  </div>
                </div>
                <form
                  method="POST"
                  action="{{ url_for('user.remove_device', device_id=device[0]) }}"
                  style="margin: 0"
                >
                  {{ inject_csrf_input()|safe }}
                  <button
                    type="submit"
                    class="btn-remove"
                    onclick="return confirm('Remove this trusted device?')"
                  >
                    Remove
                  </button>
                </form>
              </div>
              {% endfor %} {% else %}
              <div class="no-devices">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                  />
                </svg>
                <p>No trusted devices yet</p>
                <p style="font-size: 14px; margin-top: 10px">
                  Check "Remember this device" during 2FA to add one
                </p>
              </div>
              {% endif %}
            </div>
          </div>

          <div id="section-profile" class="section-hidden">
            <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Appearance</h3>
            <div class="card" style="margin-bottom: 24px">
              <div class="dark-mode-toggle">
                <div class="dark-mode-toggle-label">
                  <strong>Dark Mode</strong>
                  <span>Switch between light and dark theme</span>
                </div>
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    id="darkModeToggle"
                    onchange="toggleDarkMode()"
                  />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Settings</h3>
            <div class="card">
              {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %} {% for category, message in messages %}
              <div class="flash {{ category }}">{{ message }}</div>
              {% endfor %} {% endif %} {% endwith %}

              <form
                method="POST"
                action="{{ url_for('user.profile') }}"
                id="profileForm"
              >
                {{ inject_csrf_input()|safe }}

                <div class="form-group">
                  <label for="username">Username *</label>
                  <input
                    type="text"
                    id="username"
                    name="username"
                    value="{{ user[1] }}"
                    required
                    minlength="3"
                    maxlength="50"
                  />
                  <div class="help-text">
                    Username must be at least 3 characters. Choose wisely!
                  </div>
                </div>

                <div class="form-group">
                  <label for="name">Full Name *</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    value="{{ user[2] }}"
                    required
                  />
                </div>

                <div class="form-group">
                  <label for="role">Role</label>
                  <input type="text" id="role" value="{{ user[3] }}" disabled />
                  <div class="help-text">
                    Role cannot be changed. Contact admin if you need to change
                    your role.
                  </div>
                </div>

                <div class="form-section">
                  <h4>Change Password</h4>

                  <div
                    class="password-alert"
                    id="passwordAlert"
                    style="display: none"
                  >
                    <div class="alert-header">
                      <div class="alert-icon">!</div>
                      <div class="alert-title">Password Change Required</div>
                    </div>
                    <div class="alert-content">
                      <p>
                        For security reasons, you must change your password
                        before continuing to use the system.
                      </p>
                      <ul class="alert-list">
                        <li>Use a strong, unique password</li>
                        <li>Minimum 8 characters required</li>
                        <li>Avoid using previously used passwords</li>
                      </ul>
                    </div>
                  </div>

                  <div class="info-box" id="passwordInfoBox">
                    <div class="info-header">
                      <strong>Password Guidelines</strong>
                    </div>
                    <p>
                      Leave password fields empty if you don't want to change
                      your password
                    </p>
                    <ul class="password-requirements">
                      <li id="reqLength">Minimum 8 characters</li>
                      <li id="reqMatch">Passwords must match</li>
                      <li id="reqStrength">Strong password recommended</li>
                    </ul>
                  </div>

                  <div class="form-group">
                    <label for="new_password">New Password</label>
                    <input
                      type="password"
                      id="new_password"
                      name="new_password"
                      placeholder="Enter new password"
                      oninput="validatePassword()"
                    />
                    <div class="password-strength" id="passwordStrength">
                      <div class="strength-bar">
                        <div class="strength-fill" id="strengthFill"></div>
                      </div>
                      <div class="strength-text" id="strengthText">
                        Password strength
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="confirm_password">Confirm New Password</label>
                    <input
                      type="password"
                      id="confirm_password"
                      name="confirm_password"
                      placeholder="Re-enter new password"
                      oninput="validatePasswordMatch()"
                    />
                    <div class="match-indicator" id="matchIndicator">
                      <span class="match-icon" id="matchIcon">—</span>
                      <span class="match-text" id="matchText"
                        >Passwords must match</span
                      >
                    </div>
                  </div>

                  <div
                    class="validation-summary"
                    id="validationSummary"
                    style="display: none"
                  >
                    <div class="validation-header">
                      Password Requirements Status
                    </div>
                    <div class="validation-items">
                      <div class="validation-item" id="validationLength">
                        <span class="validation-icon">◯</span>
                        <span class="validation-text"
                          >At least 8 characters</span
                        >
                      </div>
                      <div class="validation-item" id="validationMatch">
                        <span class="validation-icon">◯</span>
                        <span class="validation-text">Passwords match</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px">
                  <button
                    type="submit"
                    class="btn btn-primary"
                    id="saveProfileBtn"
                  >
                    Save Changes
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="showSection(event, 'dashboard')"
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="sessionTimeoutWarning" class="section-hidden">
      <div class="overlay"></div>
      <div class="session-timeout-warning">
        <h3>Session About to Expire</h3>
        <p>
          Your session will expire in <span id="countdown">2:00</span> minutes
          due to inactivity.
        </p>
        <p>Would you like to extend your session?</p>
        <div
          style="
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
          "
        >
          <button class="btn btn-primary" onclick="extendSession()">
            Extend Session
          </button>
          <button class="btn btn-secondary" onclick="logoutUser()">
            Logout
          </button>
        </div>
      </div>
    </div>

    <div id="notificationToast" class="section-hidden"></div>
    <script src="/static/js/user.js"></script>
    <script>
      const APP_CONFIG = {
          getUserAttendanceUrl: "{{ url_for('user.get_attendance') }}",
          resendCodeUrl: "{{ url_for('user.resend_code') }}",
          logoutUrl: "{{ url_for('user.logout') }}",
          getDailyStatsUrl: "{{ url_for('user.get_daily_stats') }}", // NEW
          getCurrentStatusUrl: "{{ url_for('user.get_current_status') }}", // NEW
          forcePasswordChange: {{ 'true' if session.get('force_password_change') or show_password_warning else 'false' }}
      };
    </script>
  </body>
</html>